<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>MyLittleLab</title>
    <link rel="icon" type="image/png" href="/logo.png" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" />
    <link rel="stylesheet" href="/src/style.css" />
  </head>
  <body>
    <!-- Overlay de instruções tipo vidro melhorado -->
    <div id="instructions-overlay" style="
      position: fixed;
      top: 0; left: 0; width: 100vw; height: 100vh;
      background: rgba(20, 20, 30, 0.7);
      z-index: 3000;
      display: flex;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(4px) brightness(0.9);
      transition: opacity 0.4s;
      flex-direction: column;
      text-align: center;
    ">
      <img src="/logo.png" alt="Cell Logo" style="max-width: 100%; max-height: 100px;">
      <div style="color:#fff; font-size:1.15rem; margin-bottom: 1.2rem; line-height:1.6;">
        <br>
        <b>Welcome to my lab</b><br>
        <br>
        Here you can <b>observe</b> my little cells and <b>interact</b> with them.<br><br>
        <span style="color:#4fc3f7;">Scroll</span> to zoom, 
        <span style="color:#4fc3f7;">right click</span> to make cells move and
        <span style="color:#4fc3f7;">left click</span> to drag the camera.
      </div>
      <div style="color:#777777; font-size:1.1rem;">Click anywhere to start</div>
    </div>

    <!-- Menu de controle no canto superior direito -->
    <div id="settings-panel" class="position-fixed top-0 end-0 m-3" style="z-index: 2001;">
      <div class="card shadow-sm p-2 position-relative">
        <!-- Botão X para fechar -->
        <button id="btn-close-settings" type="button" class="btn-close position-absolute top-0 end-0 m-2" aria-label="Close"></button>
        <!-- Primeira linha: label Settings centralizada -->
        <div class="mb-2 text-center">
          <span class="fw-bold">Settings</span>
        </div>
        <!-- Segunda linha: botões de velocidade ocupando toda a largura -->
        <div class="mb-2">
          <div class="btn-group w-100" role="group" aria-label="Simulation speed">
            <input type="radio" class="btn-check" name="sim-speed" id="btn-0_5x" autocomplete="off">
            <label class="btn btn-sm btn-outline-primary w-100" for="btn-0_5x">0.5x</label>
            <input type="radio" class="btn-check" name="sim-speed" id="btn-1x" autocomplete="off" checked>
            <label class="btn btn-sm btn-outline-primary w-100" for="btn-1x">1x</label>
            <input type="radio" class="btn-check" name="sim-speed" id="btn-2x" autocomplete="off">
            <label class="btn btn-sm btn-outline-primary w-100" for="btn-2x">2x</label>
          </div>
        </div>
        <!-- Terceira linha: botões Pause e Random centralizados e ocupando toda a largura -->
        <div class="d-flex gap-2 justify-content-center">
          <button id="btn-pause" class="btn btn-sm btn-outline-danger flex-fill text-center">Pause</button>
          <button id="btn-random" class="btn btn-sm btn-outline-secondary flex-fill text-center">Random</button>
        </div>
      </div>
    </div>
    <!-- Botão para abrir o painel de configurações -->
    <button id="btn-open-settings" class="btn btn-primary position-fixed top-0 end-0 m-3" style="z-index:2002; display:none;">
      <span class="material-symbols-outlined align-middle">settings</span>
    </button>

    <!-- Three.js canvas (in front) -->
    <canvas id="bg"></canvas>

    <!-- Offcanvas and other UI elements remain unchanged -->
    <div class="offcanvas offcanvas-start" tabindex="-1" id="cell-menu" aria-labelledby="cellMenuLabel">
      <!-- ...rest of your menu code... -->
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"></script>
    <script type="module" src="/src/screen.js"></script>
    <script>
      // Mostra/esconde o painel de configurações
      const panel = document.getElementById('settings-panel');
      const btnClose = document.getElementById('btn-close-settings');
      const btnOpen = document.getElementById('btn-open-settings');
      const pauseBtn = document.getElementById('btn-pause');
      btnClose.addEventListener('click', () => {
        panel.style.display = 'none';
        btnOpen.style.display = 'block';
      });
      btnOpen.addEventListener('click', () => {
        panel.style.display = 'block';
        btnOpen.style.display = 'none';
      });

      // Pausa a simulação ao carregar e mostra instruções
      window.paused = true;
      let gWas = null;
      if (typeof g !== "undefined") {
        gWas = g;
        g = 0;
      }
      // Deixa o botão Pause já "clicado"
      pauseBtn.classList.add('active');
      pauseBtn.textContent = 'Resume';

      // Overlay logic
      const instructions = document.getElementById('instructions-overlay');
      instructions.addEventListener('click', () => {
        instructions.style.opacity = '0';
        setTimeout(() => { instructions.style.display = 'none'; }, 400);
        window.paused = false;
        if (typeof gWas === "number") g = gWas;
        pauseBtn.classList.remove('active');
        pauseBtn.textContent = 'Pause';
      });
    </script>
  </body>
</html>